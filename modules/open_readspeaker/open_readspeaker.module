<?php

/**
 * This is the module help website read to listen.
 */

/**
 * Implements hook_theme().
 */
function open_readspeaker_theme($existing, $type, $theme, $path) {
  return array(
    'open_readspeaker_ui' => array(
      'variables' => array(
        'accountid' => NULL,
        'open_readspeaker_i18n' => NULL,
        'open_readspeaker_reading_area' => NULL,
        'open_readspeaker_reading_area_class' => NULL,
        'custom_style' => NULL,
        'button_text' => NULL,
        'request_path' => NULL,
      ),
      'template' => 'open_readspeaker_ui',
    ),
  );
}

/**
 * Implements hook_library_info_alter().
 */
function open_readspeaker_library_info_alter(&$libraries, $extension) {
  // Update global readspeaker js with accountid.
  if ($extension == 'open_readspeaker' && isset($libraries['basic'])) {
    $accountid = \Drupal::config('open_readspeaker.settings')->get('open_readspeaker_accountid');
    unset($libraries['basic']['js']);
    if (!empty($accountid)) {
      $libraries['basic']['js']['//sf1-eu.readspeaker.com/script/' . $accountid . '/ReadSpeaker.js?pids=embhl'] = array('type' => 'external', 'minified' => 1);
    }
    else {
      $logger = \Drupal::logger('open_readspeaker');
      $logger->notice('Account ID can not be empty. Please add in Open readspeaker configuration');
    }
  }
}
